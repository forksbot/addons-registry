# Addons Registry

The addon registry database is a json file that is fetched and cached by the website and by the [Setup & Maintenance](https://github.com/openhab-nodes/ui-maintenance) tool.

This file is indirectly edited by the [Addon Registry CLI](https://github.com/openhab-nodes/cloud-addon-registry-cli) tool, that adds and alters Addon entries. The CLI does not have direct access to Github credentials. Instead the [Addon Registry Cloud Function](https://github.com/openhab-nodes/cloud-addon-registry) handles the git cloning, editing, commiting and pushing process.

## Database File Format

The database file contains a json array. Each entry has the form like in the following example:

```json
{
    "id": "binding-hue",
    "label": "Hue Binding",
    "description": "long description",
    "version": "2.5.1",
    "homepage": "https://github.com/openhab-nodes/addon-hue",
    "github": "https://github.com/openhab-nodes/addon-hue",
    "changelog_url": "/changelog.md"
    "type": "binding",
    "author": "Warner Wong",
    "manufacturers": [],
    "products": [],
    
    "archs": [
        "x86",
        "x64",
        "armv70",
        "armv80"
    ],
    "estimated_mem": {
        "min": 30,
        "max": 60
    },
    
    "permissions": {
        "mandatory": [
            "MEM_500"
        ],
        "optional": [
            "CPU_MAX"
        ]
    },
    "firewall_allow": [
        "www.google.com",
        "*"
    ],
    "ports": [
        "3000",
        "9090-9091:8080-8081",
        "6060:6060/udp"
    ],
    "linux_capabilities": [
        "NET_ADMIN"
    ],
    "devices": [
        "/dev/ttyUSB0:/dev/ttyUSB0"
    ],
    "requirements": {
        "core-iam": "1.0",
        "binding-hyperion": "2.5"
    },
    
    "author_registry": "shf5689bd6rtoon98o875vh6",
    "size": 12542542,
    "reviewed_by": [
        "David Gr√§ff"
    ],
    "last_updated": 1564580802537,
    "status": {
        "code": "AVAILABLE"
    },
}
```

The first block contains general meta information about the Addon. The second block describes installation relevant details like the machine architecture and required main memory. The third block lists all the security related data like required permissions, device mappings, linux capabilities, exposed ports and internet access rules.

All three blocks are generated out of the merged `docker-compose.yml` file(s) of the addon authors repository. The 4th and last block is generated by the [Addon Registry Cloud Function](https://github.com/openhab-nodes/cloud-addon-registry) and contains some further meta data like the size in bytes, the author id, if the addon has been reviewed, when it was last updated and its maintenance status.

## Status File Format

A second, more frequently updated, statistics file is also formatted in json and contains a json object. That object contains entries like this:

```json
"binding-hue": {
    "v": 1,
    "p": 4,
    "d": 12,
    "s": 1159,
    "iss": 466,
    "t": 1564678191977
},
```

Keys are addon ids, values are statistic json objects. The keys are in detail:

* v: Number of voters
* p: Sum of all rating points. Each vote is 1-5 points. So the average points are : `avg=p/v`.
* d: Number of downloads. This is not the active installation base and is a sum over all different versions. It is increased as soon as the AddonManager service on an installation with an enabled cloud-connector Addon starts to download an addon container. If the cloud connector Addon is not enabled, this number will not be increased.
* s: Github stars. Updated once a day.
* iss: Github issues. Updated once a day.
* t: Last updated. Unix timestamp.
